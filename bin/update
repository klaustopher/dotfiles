#!/bin/zsh

echo "\n>> Updating dotfiles repo"
pushd ~/.dotfiles
git pull origin main
popd
source ~/.zshrc

if [[ `uname` == "Darwin" ]]; then
  echo "\n>> Installing Apple Software Updates"
  sudo softwareupdate -i -a

  echo "\n>> Updating Mac App Store Apps"
  mas outdated
  mas upgrade

  echo "\n>> Updating Homebrew Packages"
  brew update

  echo "\n>> Install everything from the Brewfile"
  brew bundle --file=~/.dotfiles/homebrew/Brewfile

  echo "\n>> Upgrade Homebrew Packages"
  brew upgrade

  echo "\n>> Cleaning Up old Homebrew Packages"
  brew cleanup -s
fi

echo "\n>> Updating Rubygems for $(ruby --version)"
gem update --system

if type code > /dev/null; then
    echo "\n>> Updating VS Code Extensions"
    code --list-extensions | xargs -I{} code --install-extension {} --force
fi

if type nvim > /dev/null; then
  echo "\n>> Updating LazyVim Plugins"
  nvim --headless "+Lazy! sync" +qa
fi

pushd ~/.dotfiles
git add nvim/nvim.symlink homebrew/Brewfile.lock.json && git commit -m 'Updated LazyVim & Brewfile'
git push origin main
popd
