#!/usr/bin/env zsh
autoload -Uz colors && colors

headline() {
  print -- "\n\n$bg[blue]$fg_bold[yellow]â– $*$reset_color"
}

headline "Updating .dotfiles \uf1d3  repo"
pushd ~/.dotfiles
git pull origin main
popd
source ~/.zshrc

if [[ `uname` == "Darwin" ]]; then
  headline "Installing \ue711 Software Updates"
  sudo softwareupdate -i -a

  headline "Updating Mac App Store Apps"
  mas outdated
  mas upgrade

  headline "Updating Homebrew Packages"
  brew update

  headline "Install everything from the Brewfile"
  brew bundle --file=~/.dotfiles/homebrew/Brewfile

  headline "Upgrade Homebrew Packages"
  brew upgrade

  headline "Cleaning Up old Homebrew Packages"
  brew cleanup -s
fi

headline "Updating Rubygems for \ue739 $(ruby --version | cut -d" " -f2)"
gem update --system

if type code > /dev/null; then
    headline "Updating \udb82\ude1e VS Code Extensions"
    code --list-extensions | xargs -I{} code --install-extension {} --force
fi

if type nvim > /dev/null; then
  headline "Updating \ue6ae LazyVim Plugins"
  nvim --headless "+Lazy! sync" +qa
fi

headline "Pushing lockiles to .dotfiles \uf1d3  repo"
pushd ~/.dotfiles
git add nvim/nvim.symlink homebrew/Brewfile.lock.json && git commit -m 'Updated LazyVim & Brewfile'
git push origin main
popd
